<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.19b80db8795d782d4d1f.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--HnDWV{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--ZztQd{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--BY7f8,.Author-module--author__title-link--BY7f8:focus,.Author-module--author__title-link--BY7f8:hover{color:#222}.Author-module--author__subtitle--3hbMX{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--1T2h2{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--3fb7G{margin-bottom:1.625rem}.Contacts-module--contacts__list--27zok{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--1Adud{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2L60c{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2L60c:focus,.Contacts-module--contacts__list-item-link--2L60c:hover{color:#5d93ff}.Copyright-module--copyright--1YLES{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--2aN3O{margin-bottom:1.625rem}.Menu-module--menu__list--1uKDu{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--27cxj{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--29Sd-{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--29Sd-:focus,.Menu-module--menu__list-item-link--29Sd-:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2HzKy{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--1zM7S{width:100%}.Sidebar-module--sidebar__inner--2Tprz{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--1zM7S{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--1zM7S:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--1zM7S:last-child{margin-right:0}.Sidebar-module--sidebar--1zM7S:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--1zM7S:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--2Tprz{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--2Tprz:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--1zM7S{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--1zM7S:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--1zM7S:last-child{margin-right:0}.Sidebar-module--sidebar--1zM7S:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--1zM7S:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--2Tprz{padding:2.5rem}}.Layout-module--layout--EpQHE{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--EpQHE:before{content:"";display:table}.Layout-module--layout--EpQHE:after{content:"";display:table;clear:both}.Feed-module--feed__item--Bm0MP{margin-bottom:2.03125rem}.Feed-module--feed__item--Bm0MP:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--34sOw{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--2qfTF{color:#222}.Feed-module--feed__item-title-link--2qfTF:focus,.Feed-module--feed__item-title-link--2qfTF:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--2_Zuy{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3hc6b{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--2GeAw{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--lAu1I{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--lAu1I:focus,.Feed-module--feed__item-meta-category-link--lAu1I:hover{color:#5d93ff}.Feed-module--feed__item-readmore--rMfbv{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--rMfbv:focus,.Feed-module--feed__item-readmore--rMfbv:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--V2155{margin-bottom:3.25rem}.Page-module--page__inner--3xzwp{padding:1.5625rem 1.25rem}.Page-module--page__title--t1zKX{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--1A7TB{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--V2155{width:calc(58.275% - .78125rem)}.Page-module--page--V2155:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--V2155:last-child{margin-right:0}.Page-module--page--V2155:nth-child(12n){margin-right:0;float:right}.Page-module--page--V2155:nth-child(12n+1){clear:both}.Page-module--page__inner--3xzwp{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--V2155{width:calc(66.6% - .625rem)}.Page-module--page--V2155:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--V2155:last-child{margin-right:0}.Page-module--page--V2155:nth-child(3n){margin-right:0;float:right}.Page-module--page--V2155:nth-child(3n+1){clear:both}.Page-module--page__inner--3xzwp{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--3T_m0{margin-top:3.25rem;display:flex}.Pagination-module--pagination__prev--3tRFv{width:50%;text-align:left}.Pagination-module--pagination__prev-link--2vesn{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--2vesn:focus,.Pagination-module--pagination__prev-link--2vesn:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--1Fxw2{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--19bJd{width:50%;text-align:right}.Pagination-module--pagination__next-link--3ln7y{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3ln7y:focus,.Pagination-module--pagination__next-link--3ln7y:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--AsM50{pointer-events:none;color:#bbb}.Author-module--author--2kf8a{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--MufFK{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2kf8a{margin-left:auto;margin-right:auto}}.Content-module--content--1tfQQ{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--1qFLI{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2bfha figure{margin-bottom:1.625rem}.Content-module--content__body--2bfha figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2bfha figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2bfha a{text-decoration:underline}.Content-module--content__body--2bfha *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2bfha img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--1tfQQ{padding:0}.Content-module--content__title--1qFLI{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2bfha,.Content-module--content__body--2bfha p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--3FNDv{font-style:italic}.Tags-module--tags--1oNz4{margin-bottom:.8125rem}.Tags-module--tags__list--2UTD-{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--b7tap{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--1hQL0{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--1hQL0:focus,.Tags-module--tags__list-item-link--1hQL0:hover{color:#5d93ff}.Post-module--post__comments--2T8dL,.Post-module--post__footer--1BvmJ{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--3zx_9{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--3zx_9:focus,.Post-module--post__home-button--3zx_9:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--2T8dL,.Post-module--post__footer--1BvmJ{padding:0}.Post-module--post__home-button--3zx_9{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="Shaun Chuah" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Q9BZXJ07YY"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Q9BZXJ07YY', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=f43f4a2111148eca68cb55e8dd43a4d8" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=f43f4a2111148eca68cb55e8dd43a4d8"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=f43f4a2111148eca68cb55e8dd43a4d8"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=f43f4a2111148eca68cb55e8dd43a4d8"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=f43f4a2111148eca68cb55e8dd43a4d8"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=f43f4a2111148eca68cb55e8dd43a4d8"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=f43f4a2111148eca68cb55e8dd43a4d8"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=f43f4a2111148eca68cb55e8dd43a4d8"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=f43f4a2111148eca68cb55e8dd43a4d8"/><title data-react-helmet="true">Setting Up Azure with Nextflow - Shaun Chuah</title><meta data-react-helmet="true" name="description" content="How to set up your own cloud supercomputer."/><meta data-react-helmet="true" property="og:site_name" content="Setting Up Azure with Nextflow - Shaun Chuah"/><meta data-react-helmet="true" property="og:image" content="https://shaunchuah.github.io/static/dcaaae8931fa427839223d1a6670cc72/azure_nextflow.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Setting Up Azure with Nextflow - Shaun Chuah"/><meta data-react-helmet="true" name="twitter:description" content="How to set up your own cloud supercomputer."/><meta data-react-helmet="true" name="twitter:image" content="https://shaunchuah.github.io/static/dcaaae8931fa427839223d1a6670cc72/azure_nextflow.jpg"/><link as="script" rel="preload" href="/webpack-runtime-b971c9f2a609e62d6311.js"/><link as="script" rel="preload" href="/framework-1e331b2e9d55ebef6dec.js"/><link as="script" rel="preload" href="/532a2f07-d05f238db5f768b1710d.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-efc6dda1b9b18befbcb4.js"/><link as="script" rel="preload" href="/app-f2bfddcfff95ad3c3af5.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-09e2d09d003a03c09b06.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-177bfb7e39d16785d8ef.js"/><link as="fetch" rel="preload" href="/page-data\posts\setting-up-azure-with-nextflow\page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data\app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--EpQHE"><div><a class="Post-module--post__home-button--3zx_9" href="/">All Articles</a><div><div class="Content-module--content--1tfQQ"><h1 class="Content-module--content__title--1qFLI">Setting Up Azure with Nextflow</h1><div class="Content-module--content__body--2bfha"><p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/dcaaae8931fa427839223d1a6670cc72/dbec1/azure_nextflow.jpg"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcDOikK//8QAGBAAAwEBAAAAAAAAAAAAAAAAAAERAiD/2gAIAQEAAQUCy4PVLx//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAASD/2gAIAQEABj8CHP8A/8QAGhAAAgIDAAAAAAAAAAAAAAAAAREAIDFR4f/aAAgBAQABPyEaYa1B8Kv/2gAMAwEAAgADAAAAEIjP/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Qp//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAECAQE/EIf/xAAZEAEAAwEBAAAAAAAAAAAAAAABESExABD/2gAIAQEAAT8QfRJLZcw0LXAeBRp6WG98/9k='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/dcaaae8931fa427839223d1a6670cc72/8ac56/azure_nextflow.webp 240w,
/static/dcaaae8931fa427839223d1a6670cc72/d3be9/azure_nextflow.webp 480w,
/static/dcaaae8931fa427839223d1a6670cc72/e46b2/azure_nextflow.webp 960w,
/static/dcaaae8931fa427839223d1a6670cc72/f992d/azure_nextflow.webp 1440w,
/static/dcaaae8931fa427839223d1a6670cc72/882b9/azure_nextflow.webp 1920w,
/static/dcaaae8931fa427839223d1a6670cc72/76078/azure_nextflow.webp 1933w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/dcaaae8931fa427839223d1a6670cc72/09b79/azure_nextflow.jpg 240w,
/static/dcaaae8931fa427839223d1a6670cc72/7cc5e/azure_nextflow.jpg 480w,
/static/dcaaae8931fa427839223d1a6670cc72/6a068/azure_nextflow.jpg 960w,
/static/dcaaae8931fa427839223d1a6670cc72/644c5/azure_nextflow.jpg 1440w,
/static/dcaaae8931fa427839223d1a6670cc72/0f98f/azure_nextflow.jpg 1920w,
/static/dcaaae8931fa427839223d1a6670cc72/dbec1/azure_nextflow.jpg 1933w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/jpeg"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/dcaaae8931fa427839223d1a6670cc72/6a068/azure_nextflow.jpg"
            alt="Setting up azure with nextflow"
            title="Setting up azure with nextflow"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>We will cover getting your nextflow pipeline up and running in the cloud using Azure. First thing to note, this will take quite a number of hours if not a few days so sit back, grab a coffee and take your time working through each section.</p>
<h3 id="useful-references" style="position:relative;"><a href="#useful-references" aria-label="useful references permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Useful References</h3>
<p>Nextflow documentation <a href="https://www.nextflow.io/docs/edge/azure.html" target="_blank" rel="nofollow noopener noreferrer">here</a>.
Nextflow blog post <a href="https://www.nextflow.io/blog/2021/introducing-nextflow-for-azure-batch.html" target="_blank" rel="nofollow noopener noreferrer">here</a>.</p>
<h2 id="table-of-contents" style="position:relative;"><a href="#table-of-contents" aria-label="table of contents permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Table of Contents</h2>
<ol>
<li><a href="#1-context">Context</a></li>
<li><a href="#2-why-azure-over-gcpaws">Why Azure over GCP/AWS</a></li>
<li><a href="#3-setting-up-your-azure-account">Setting up your Azure account</a></li>
<li><a href="#4-configuring-nextflow">Configuring Nextflow</a></li>
<li><a href="#5-separating-credentials-out-of-nextflow-config">Separating Credentials Out of Nextflow Config</a></li>
<li><a href="#6-running-test-and-production-pipelines">Running Test and Production Pipelines</a></li>
<li><a href="#7-requesting-a-quota-increase">Requesting A Quota Increase</a></li>
</ol>
<h2 id="1-context" style="position:relative;"><a href="#1-context" aria-label="1 context permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Context</h2>
<p>Let’s start with some context. I’m working with a small team of immunology researchers who are following their scientific questions which has led  into genomics. We don’t have any bioinformatics setup and are starting from nothing - which is probably going to be the case for many newcomers as NGS technology continues to become more accessible (for example Nanopore sequencing).</p>
<p>The University has a compute cluster but it is equally challenging to get up and running there as on the cloud. In 2021, if you are starting from scratch, I would recommend a cloud-first approach as the cloud allow scalability way beyond any high performance compute cluster at a fraction of the cost. Also, you can access the cloud from anywhere and do not have to setup VPNs etc. to use a university network.</p>
<h2 id="2-why-azure-over-gcpaws" style="position:relative;"><a href="#2-why-azure-over-gcpaws" aria-label="2 why azure over gcpaws permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. Why Azure over GCP/AWS?</h2>
<p>When I first attempted to get Nextflow up and running in the cloud, naturally AWS (Amazon Web Services) was the first contender. For those of you new to cloud computing, AWS is the most established player having been around the longest.</p>
<p>However, following the Nextflow documentation requires you to create a custom Amazon Machine Image that has awscli installed and no matter how many different attempts I tried, I just couldn’t get it to work properly. I suspect updates to Amazon’s infrastructure have changed the previous instructions available on the internet.</p>
<p>After Amazon, I tried Google Cloud using their Cloud Life Sciences API and Nextflow. It was incredibly easy to get things up and running however I soon ran into limitations on vCPU quota. Google limits new accounts to 8 vCPUs even though you have put your credit card on and upgraded your account. </p>
<p>When I contacted Google Support about increasing the quota, they replied and suggested contacting one of their partners and sent a link with a list of maybe a hundred companies, of which you would have no idea who would do bioinformatics. Also, I’m really not interested in going through a third party to get my account running. I might also mention my slight worry that Google does not have a great track record of supporting their non-advertising projects. <a href="https://killedbygoogle.com/" target="_blank" rel="nofollow noopener noreferrer">See Here</a> (I will never forget Google Reader!)</p>
<p>Finally, after much time spent on the above two, I had nothing to lose giving Azure a try. Initially, Azure’s interface was almost as complex as AWS. However, once you set it up, <strong>Azure support were the most responsive in getting your vCPU quota up</strong>. Within 30 minutes of setting up my account I obtained 48 vCPUs and subsequently had it increased to 128 with very little hassle at all.</p>
<p>Therefore, if you’re going to do what I did, I would highly recommend you try Azure first and this is my documentation of what worked in the end after about 2 weeks of effort.</p>
<h2 id="3-setting-up-your-azure-account" style="position:relative;"><a href="#3-setting-up-your-azure-account" aria-label="3 setting up your azure account permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Setting Up Your Azure Account</h2>
<p>Let’s kick things off. First, sign up for an <a href="https://azure.microsoft.com" target="_blank" rel="nofollow noopener noreferrer">Azure</a> account (that pretty much goes without saying).</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7e5d99f2bc91885370976a7b549ec841/9b29b/azure_dashboard.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABI0lEQVQoz6VRW07EMAzs/c8Dh4BLrPjhsVugbdL4FTtMWhZY4AdhRZEje+yZySBMlObw2ty2u0bU1rzf4a1F+z16acgkUyqFbSn8MqdlpV7aICK6Fqoe+zGPlAuxIhE1NRvEKgruVVXdezbK6ZHuj+NdyXNEM/dVvEV0Mlv4OYYLLtEmmq4frm7Hm0M6ZMugX83AzgyrPmCxj/gEYwkzo7V11QFR4PZ0ei7Tq4q6VTgy57IsCT19QMRXcAjLPrICHaFbvO9CtKBCcIFEtTrO8M3ErGTwfJvV+7esivSHO1CwC/QhAecCLKzH41jSyrlIytDJxFKKUpfj1bCTWbp3u2FxDoBTIkhKOU1pkpKgGX/DOeND9ga8UAcZ7zx+0P5T/Av8BmwOh45tS7dyAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/7e5d99f2bc91885370976a7b549ec841/8ac56/azure_dashboard.webp 240w,
/static/7e5d99f2bc91885370976a7b549ec841/d3be9/azure_dashboard.webp 480w,
/static/7e5d99f2bc91885370976a7b549ec841/e46b2/azure_dashboard.webp 960w,
/static/7e5d99f2bc91885370976a7b549ec841/f992d/azure_dashboard.webp 1440w,
/static/7e5d99f2bc91885370976a7b549ec841/882b9/azure_dashboard.webp 1920w,
/static/7e5d99f2bc91885370976a7b549ec841/93e07/azure_dashboard.webp 3840w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/7e5d99f2bc91885370976a7b549ec841/8ff5a/azure_dashboard.png 240w,
/static/7e5d99f2bc91885370976a7b549ec841/e85cb/azure_dashboard.png 480w,
/static/7e5d99f2bc91885370976a7b549ec841/d9199/azure_dashboard.png 960w,
/static/7e5d99f2bc91885370976a7b549ec841/07a9c/azure_dashboard.png 1440w,
/static/7e5d99f2bc91885370976a7b549ec841/29114/azure_dashboard.png 1920w,
/static/7e5d99f2bc91885370976a7b549ec841/9b29b/azure_dashboard.png 3840w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/7e5d99f2bc91885370976a7b549ec841/d9199/azure_dashboard.png"
            alt="Azure dashboard"
            title="Azure dashboard"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
<em>Azure Cloud Dashboard</em></p>
<p>Here’s the important bit.</p>
<p><strong>Once you have your Azure account, within Azure, you need to create two accounts: one Azure Batch account and one Azure Storage account.</strong></p>
<h3 id="batch-and-storage-account-creation" style="position:relative;"><a href="#batch-and-storage-account-creation" aria-label="batch and storage account creation permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Batch and Storage Account Creation</h3>
<p>Login into Azure Portal and search for ‘batch’ in the top bar. You should then click on Batch accounts. Create a batch account name and the location where you want to run your compute. When you are creating your batch account, it will ask you to associate a storage account - now is a good time to create your storage account as well.</p>
<h3 id="create-a-storage-container" style="position:relative;"><a href="#create-a-storage-container" aria-label="create a storage container permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create A Storage Container</h3>
<p>Once you have your storage account, enter it and click on containers in the left menubar. Then click ’+ container’ and set up a ‘blob’ - this is equivalent to Amazon S3 and will function as the filesystem Azure Batch will read and write files to.</p>
<h3 id="get-your-account-keys" style="position:relative;"><a href="#get-your-account-keys" aria-label="get your account keys permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Get Your Account Keys</h3>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a9df47b02a9e9d26cb19057d229e2c25/9b29b/batch_account.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABMElEQVQoz31S2XLDIAzM//9lXtomtR1sgy4EdLFbJ+nFeDyLpNW1nIyjcmqtiXCax5altapCc5haK8Dt73OawrLEyMLXMYy3QMSJaF4prCln91JKrV6rmrGoecnbV2rzUk9qOVsu7imJWUY+ZoHbvJWHqkSUiFmzPxhPB2LteQBU5BrSZRHPuX6dIwytiKCMwXgnv769nM9nVXV3RoO1wQ0My84HDU3Cssc/kcO8hDDDhiFWkupWtpExrffpfSO7ELv36xOZROEDWEnDMHKMtSCqzJF7llqQFy5UoBh7plLuZCilCp1a3uq0TaVjVoDO/ybVgSLWrboHrimZWIUImMH66h1//0E+lplQOvXXEqO8X4ZpnMZx4NuUhkVZkegXMlrfm1T7lOqQZ+uz/vPIPgBhI4ec8aJL0gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/a9df47b02a9e9d26cb19057d229e2c25/8ac56/batch_account.webp 240w,
/static/a9df47b02a9e9d26cb19057d229e2c25/d3be9/batch_account.webp 480w,
/static/a9df47b02a9e9d26cb19057d229e2c25/e46b2/batch_account.webp 960w,
/static/a9df47b02a9e9d26cb19057d229e2c25/f992d/batch_account.webp 1440w,
/static/a9df47b02a9e9d26cb19057d229e2c25/882b9/batch_account.webp 1920w,
/static/a9df47b02a9e9d26cb19057d229e2c25/93e07/batch_account.webp 3840w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/a9df47b02a9e9d26cb19057d229e2c25/8ff5a/batch_account.png 240w,
/static/a9df47b02a9e9d26cb19057d229e2c25/e85cb/batch_account.png 480w,
/static/a9df47b02a9e9d26cb19057d229e2c25/d9199/batch_account.png 960w,
/static/a9df47b02a9e9d26cb19057d229e2c25/07a9c/batch_account.png 1440w,
/static/a9df47b02a9e9d26cb19057d229e2c25/29114/batch_account.png 1920w,
/static/a9df47b02a9e9d26cb19057d229e2c25/9b29b/batch_account.png 3840w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/a9df47b02a9e9d26cb19057d229e2c25/d9199/batch_account.png"
            alt="Batch account keys"
            title="Batch account keys"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p><strong>Batch account:</strong> Enter your batch account and click ‘Keys’ in the left menubar. Take a note of the name and key1.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/c80903d517baf32ebab81a0791f5dfc9/9b29b/storage_account.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAvElEQVQoz52QwW4DIQxE+f8/XDVVL5WqJC0L2AYMGOKlipScNtnRHEDy89g2nBwTjM6jt/GmzAqRSylN/lb/a1e7eudDCBAAkWJtIr3/u8rmNt37UBsiyjm31qy1AKDfGCMiZua+m4xEGiwiGsTMtVaZ2prvwgFp1ioM+UEi+ycwGJPWKa2jzuTtrd3GeCF5WZbP00cIXlfVQL5r8nvw+XrxzunB5Fkv7Qwx1VLGIRmLlFM6CH99/yCEY/ANKYKKL7aVgH4AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/c80903d517baf32ebab81a0791f5dfc9/8ac56/storage_account.webp 240w,
/static/c80903d517baf32ebab81a0791f5dfc9/d3be9/storage_account.webp 480w,
/static/c80903d517baf32ebab81a0791f5dfc9/e46b2/storage_account.webp 960w,
/static/c80903d517baf32ebab81a0791f5dfc9/f992d/storage_account.webp 1440w,
/static/c80903d517baf32ebab81a0791f5dfc9/882b9/storage_account.webp 1920w,
/static/c80903d517baf32ebab81a0791f5dfc9/93e07/storage_account.webp 3840w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/c80903d517baf32ebab81a0791f5dfc9/8ff5a/storage_account.png 240w,
/static/c80903d517baf32ebab81a0791f5dfc9/e85cb/storage_account.png 480w,
/static/c80903d517baf32ebab81a0791f5dfc9/d9199/storage_account.png 960w,
/static/c80903d517baf32ebab81a0791f5dfc9/07a9c/storage_account.png 1440w,
/static/c80903d517baf32ebab81a0791f5dfc9/29114/storage_account.png 1920w,
/static/c80903d517baf32ebab81a0791f5dfc9/9b29b/storage_account.png 3840w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/c80903d517baf32ebab81a0791f5dfc9/d9199/storage_account.png"
            alt="Storage account keys"
            title="Storage account keys"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p><strong>Storage account:</strong> Enter your storage account and click ‘Access Keys’ in the left menubar. Again, take note of the storage account name and key1.</p>
<p><strong>That’s it for this step. Now it’s time to setup Nextflow.</strong></p>
<h2 id="4-configuring-nextflow" style="position:relative;"><a href="#4-configuring-nextflow" aria-label="4 configuring nextflow permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. Configuring Nextflow</h2>
<p>I’m going to show you an example configuration here and explain it in detail. The details of your configuration will depend on your pipeline and compute requirements. I hope this serves as an easy template to follow. See the previous post for the nextflow pipeline.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">profiles {
  az {
      params.reads = 'az://scgenomics/test_data/*/*_{R1,R2}_*.fastq.gz'
      params.outdir = 'az://scgenomics/test_reports'
      params.bowtie2_reference_index = "az://scgenomics/bt2_index.tar.gz"
      params.kraken2_db = "az://scgenomics/k2_standard_8gb_20210517.tar.gz"
      params.metaphlan_db = "az://scgenomics/metaphlan_db.tar.gz"
      params.cpus = 16
      process.executor = 'azurebatch'
      workDir = 'az://scgenomics/work/'
      azure {
          storage {
              accountName = azure_config["storageAccountName"]
              accountKey = azure_config["storageAccountKey"]
          }
          batch {
              location = 'uksouth'
              accountName = azure_config["batchAccountName"]
              accountKey = azure_config["batchAccountKey"]
              autoPoolMode = true
              pools {
                  auto {
                      vmType = 'Standard_D16_v3'
                      maxVmCount = 8
                      autoScale = true
                  }
              }
          }
      }
  }
  az_prod {
      params.reads = 'az://scgenomics/data/*/*_{R1,R2}_*.fastq.gz'
      params.outdir = 'az://scgenomics/reports'
      params.bowtie2_reference_index = "az://scgenomics/bt2_index.tar.gz"
      params.kraken2_db = "az://scgenomics/k2_standard_20210517.tar.gz"
      params.metaphlan_db = "az://scgenomics/metaphlan_db.tar.gz"
      params.cpus = 16
      process.executor = 'azurebatch'
      workDir = 'az://scgenomics/production_work/'
      azure {
          storage {
              accountName = azure_config["storageAccountName"]
              accountKey = azure_config["storageAccountKey"]
          }
          batch {
              location = 'uksouth'
              accountName = azure_config["batchAccountName"]
              accountKey = azure_config["batchAccountKey"]
              autoPoolMode = true
              pools {
                  auto {
                      vmType = 'Standard_D16_v3'
                      maxVmCount = 8
                      autoScale = true
                  }
              }
          }
      }
  }
}</code></pre></div>
<h3 id="create-test-and-production-profiles" style="position:relative;"><a href="#create-test-and-production-profiles" aria-label="create test and production profiles permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create test and production profiles</h3>
<p>In your nextflow.config file - set up profiles. I’ve set up two profiles which are almost identical. One is for testing and the other is when you actually want to run the real workflow. In the following example my test profile is named ‘az’ and the production profile is ‘az_prod’. Feel free to change it to what you want.</p>
<h3 id="lets-break-it-down" style="position:relative;"><a href="#lets-break-it-down" aria-label="lets break it down permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Let’s break it down</h3>
<p>First, let’s start with pipeline parameters. This will probably be different to your application. I’ve identified where my data resides and where I want my reports to be placed.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">  params.reads = 'az://scgenomics/data/*/*_{R1,R2}_*.fastq.gz'
  params.outdir = 'az://scgenomics/reports'</code></pre></div>
<h4 id="2-major-points-to-note-here" style="position:relative;"><a href="#2-major-points-to-note-here" aria-label="2 major points to note here permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2 Major Points to Note Here</h4>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">  params.bowtie2_reference_index = "az://scgenomics/bt2_index.tar.gz"
  params.kraken2_db = "az://scgenomics/k2_standard_20210517.tar.gz"
  params.metaphlan_db = "az://scgenomics/metaphlan_db.tar.gz"</code></pre></div>
<p><strong>Important</strong> Azure’s containers doesn’t work like a real filesystem. When using reference databases I found that the pipeline doesn’t read folders. What I’ve done is zipped up the reference DBs and unzipped them in the process so that the database is copied over to the VM.</p>
<p><strong>Second Point</strong> I would upload a copy of the reference database to your storage account. This is because pulling files from your storage account to the VM is really fast whereas if you asked the VM to download the database from the original external servers you are going to cause two major problems:</p>
<ol>
<li>It’s much slower downloading a database from S3 to Azure.</li>
<li>You’re going to incur high bandwidth transfer costs both for yourself and for the team hosting the database. Not a great idea to download 20GB everytime you run a single process.</li>
<li>Be nice and considerate to the kind folks who host the databases</li>
</ol>
<p><strong>Therefore, download a single copy of the reference database, zip it up and put it in your storage container.</strong></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">  params.cpus = 16</code></pre></div>
<p>This just allows me to tweak the number of cores and is completely optional. My local machine has only 4 while I use 16 core VMs on Azure. On the process side of Nextflow I declare the cpus option as a variable that allows me to tweak the entire pipeline with a change of a single number.</p>
<p>Here’s a brief snippet to give you an idea (pipeline.nf file):</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">process bowtie2 {
    container 'biocontainers/bowtie2:v2.4.1_cv1'
    cpus "$params.cpus".toInteger()</code></pre></div>
<h3 id="finally-the-magic" style="position:relative;"><a href="#finally-the-magic" aria-label="finally the magic permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Finally the magic</h3>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">  process.executor = 'azurebatch'
  workDir = 'az://scgenomics/production_work/'
  azure {
      storage {
          accountName = azure_config["storageAccountName"]
          accountKey = azure_config["storageAccountKey"]
      }
      batch {
          location = 'uksouth'
          accountName = azure_config["batchAccountName"]
          accountKey = azure_config["batchAccountKey"]
          autoPoolMode = true
          pools {
              auto {
                  vmType = 'Standard_D16_v3'
                  maxVmCount = 8
                  autoScale = true
              }
          }
      }
  }</code></pre></div>
<p>This block configures Azure Batch settings. You will see that I run <code class="language-text">Standard_D16_v3</code> machines and I use up to 8 VMs for my pipeline. Have a look at <a href="https://azure.microsoft.com/en-gb/pricing/details/virtual-machines/series/" target="_blank" rel="nofollow noopener noreferrer">Azure’s VMs</a> to have an idea of what machines are available. Your settings for this will be entirely dependent on your quotas and what you’re trying to run. Since kraken2 requires 64GB of RAM those are the VMs I’ve selected.</p>
<h2 id="5-separating-credentials-out-of-nextflow-config" style="position:relative;"><a href="#5-separating-credentials-out-of-nextflow-config" aria-label="5 separating credentials out of nextflow config permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Separating Credentials Out of Nextflow Config</h2>
<p>I’m assuming you are using git to version track your code. There are other tutorials on how to do that so look it up if you don’t. Personally I commit my code to GitHub and would suggest you do something similar as it will allow further cool automations that I will cover in the future.</p>
<p>In the above section you will notice this block of code which is different from what Nextflow’s documentation is.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">accountName = azure_config["batchAccountName"]
accountKey = azure_config["batchAccountKey"]</code></pre></div>
<p>I’m going to explain how to separate out your credentials from your nextflow.config file. You will often hear people scream <strong>‘Don’t commit your credentials to git!’</strong> They are right of course - if people get hold of your credentials they could run their pipelines on your credit card!</p>
<p><strong>However, how to avoid doing this is often unclear and leaves beginners wondering what they are supposed to do instead..</strong></p>
<h3 id="how-i-separate-credentials-out" style="position:relative;"><a href="#how-i-separate-credentials-out" aria-label="how i separate credentials out permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How I Separate Credentials Out</h3>
<p>I have my credentials in a separate JSON file named <code class="language-text">credentials.json</code> that is added to the <code class="language-text">.gitignore</code> file to avoid committing that to the repo.</p>
<p>Here is the json file which is literally 6 lines that you can fill in and rename to <code class="language-text">credentials.json</code></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">{
    "storageAccountName": "",
    "storageAccountKey": "",
    "batchAccountName": "",
    "batchAccountKey": ""
}</code></pre></div>
<p>Make sure you add the line <code class="language-text">credentials.json</code> to your <code class="language-text">.gitignore</code> file. If you don’t have <code class="language-text">.gitignore</code>, create one.</p>
<p>Now open <code class="language-text">nextflow.config</code> and at the top here’s what I’ve got:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">import groovy.json.JsonSlurper
def JsonSlurper = new JsonSlurper()
azure_config = JsonSlurper.parse(new File("./credentials.json"))</code></pre></div>
<p>This allows nextflow.config to read your <code class="language-text">credentials.json</code> file which is in the same directory as the config file.</p>
<p>Side note: due to relative file naming you do need to run nextflow in the root directory of your repo.</p>
<p>That’s it, 9 lines of code and a <code class="language-text">.gitignore</code> file to protect you from exposing your sensitive information on the internet!</p>
<h2 id="6-running-test-and-production-pipelines" style="position:relative;"><a href="#6-running-test-and-production-pipelines" aria-label="6 running test and production pipelines permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6. Running Test and Production Pipelines</h2>
<p>To run my test pipeline (my pipeline file is named pipeline.nf, other common names include main.nf):</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">nextflow pipeline.nf -resume -profile az</code></pre></div>
<p>To run production:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">nextflow pipeline.nf -resume -profile az_prod</code></pre></div>
<p>You can watch Azure Batch spin up VMs in Azure Portal.</p>
<h2 id="7-requesting-a-quota-increase" style="position:relative;"><a href="#7-requesting-a-quota-increase" aria-label="7 requesting a quota increase permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>7. Requesting A Quota Increase</h2>
<p>Go to your batch account, click ‘quotas’ in the sidebar and then there is a button ‘Request quota increase’. Fill that in for your desired VM and Microsoft Support will hopefully quickly approve that.</p>
<h2 id="whats-next" style="position:relative;"><a href="#whats-next" aria-label="whats next permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What’s next?</h2>
<p>The above steps should get you up and running initially on your own cloud supercomputer. However, you will quickly realise that this launches the pipeline from your local machine and as you know, real production pipelines can run for hours. During this time, your computer needs to remain active as it is the main controller for scheduling and arranging jobs.</p>
<p>In a future article, I will cover launching pipelines from a cloud server or ‘head node’ and using <code class="language-text">screen</code> to keep long running processes active. This will let you launch pipelines from anywhere and turn off your main computer. You can even code directly on your cloud machine using VSCode Remote. Once you’ve tried this you will never go back!</p></div></div></div><div class="Post-module--post__footer--1BvmJ"><div><p class="Meta-module--meta__date--3FNDv">Published <!-- -->Aug 18, 2021</p></div><div class="Tags-module--tags--1oNz4"><ul class="Tags-module--tags__list--2UTD-"><li class="Tags-module--tags__list-item--b7tap"><a class="Tags-module--tags__list-item-link--1hQL0" href="/tag/bioinformatics/">Bioinformatics</a></li><li class="Tags-module--tags__list-item--b7tap"><a class="Tags-module--tags__list-item-link--1hQL0" href="/tag/azure/">Azure</a></li><li class="Tags-module--tags__list-item--b7tap"><a class="Tags-module--tags__list-item-link--1hQL0" href="/tag/nextflow/">Nextflow</a></li><li class="Tags-module--tags__list-item--b7tap"><a class="Tags-module--tags__list-item-link--1hQL0" href="/tag/cloud-computing/">Cloud computing</a></li><li class="Tags-module--tags__list-item--b7tap"><a class="Tags-module--tags__list-item-link--1hQL0" href="/tag/dev-ops/">DevOps</a></li></ul></div><div class="Author-module--author--2kf8a"><p>Gastroenterology registrar. Occasional web developer. Interested in technology.<a class="Author-module--author__bio-twitter--MufFK" href="https://www.twitter.com/chershiong" rel="noopener noreferrer" target="_blank"><strong>Shaun Chuah</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--2T8dL"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/setting-up-azure-with-nextflow";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b11f7ed7be365f7aa0c9.js"],"app":["/app-f2bfddcfff95ad3c3af5.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-aa2de9772640235b1335.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-58742d2936ad58100815.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-551f30d370d85d05ff04.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-8b64bb5b6162dcc78f90.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-177bfb7e39d16785d8ef.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-2891a77df03c6e824b15.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-b11f7ed7be365f7aa0c9.js" nomodule=""></script><script src="/component---src-templates-post-template-js-177bfb7e39d16785d8ef.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-09e2d09d003a03c09b06.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-f2bfddcfff95ad3c3af5.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-efc6dda1b9b18befbcb4.js" async=""></script><script src="/532a2f07-d05f238db5f768b1710d.js" async=""></script><script src="/framework-1e331b2e9d55ebef6dec.js" async=""></script><script src="/webpack-runtime-b971c9f2a609e62d6311.js" async=""></script></body></html>